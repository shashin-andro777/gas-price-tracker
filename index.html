<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA Gas Price Tracker</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for the graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the "tomorrow" price card */
        .price-card {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.1);
        }
        .price-card .price {
            font-weight: 900; /* Black weight for impact */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">GTA Gas Prices</h1>
            <p class="text-slate-600 mt-2">Historical data and next-day price for the Greater Toronto Area.</p>
        </header>

        <!-- Main Content Area -->
        <main>
            <!-- Tomorrow's Price Card -->
            <div id="price-card-container" class="mb-8">
                <div class="price-card text-white rounded-2xl p-6 md:p-8 flex flex-col items-center justify-center text-center">
                    <h2 class="text-2xl md:text-3xl font-bold uppercase tracking-wider">Price for Tomorrow</h2>
                    <p id="tomorrow-date" class="text-lg text-blue-200 mb-2">Loading...</p>
                    <div id="tomorrow-price" class="price text-7xl md:text-8xl">
                        <span id="price-value">--.-</span>
                        <span class="text-5xl font-medium">¢</span>
                    </div>
                    <p class="text-sm text-blue-300 mt-2">per litre</p>
                </div>
            </div>

            <!-- Historical Data Chart -->
            <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold mb-4 text-center md:text-left">Price History (Last 30 Days)</h3>
                <div id="chart-container" style="position: relative; height: 60vh; max-height: 400px;">
                    <canvas id="gasPriceChart"></canvas>
                </div>
                <div id="loading-indicator" class="text-center p-8">
                    <p>Loading chart data...</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-8 text-slate-500 text-sm">
            <p>Data sourced from CityNews. Not for commercial use.</p>
            <p>Last updated: <span id="last-updated">loading...</span></p>
        </footer>

    </div>

    <script>
        // --- Configuration ---
        const DATA_URL = './gas_prices.json'; // The path to our data file

        // --- Main Function to Load Data and Build the Page ---
        async function initializeApp() {
            try {
                // Fetch the gas price data from our JSON file.
                // We add a cache-busting query parameter to ensure we always get the latest version.
                const response = await fetch(`${DATA_URL}?v=${new Date().getTime()}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Hide the loading indicator once data is fetched
                document.getElementById('loading-indicator').style.display = 'none';

                // Ensure data is not empty
                if (data && data.length > 0) {
                    // The data is sorted by date, so the last item is the most recent.
                    const latestEntry = data[data.length - 1];
                    
                    // Update the "Tomorrow's Price" card
                    updatePriceCard(latestEntry);

                    // Create the historical price chart
                    createChart(data);

                    // Update the "Last Updated" timestamp in the footer
                    document.getElementById('last-updated').textContent = new Date().toLocaleString();
                } else {
                    throw new Error("Data file is empty or invalid.");
                }

            } catch (error) {
                console.error("Failed to initialize app:", error);
                // Display an error message to the user
                document.getElementById('loading-indicator').textContent = 'Error: Could not load price data.';
                document.getElementById('price-value').textContent = 'Error';
            }
        }

        // --- Function to Update the Price Card ---
        function updatePriceCard(entry) {
            const priceValueElement = document.getElementById('price-value');
            const tomorrowDateElement = document.getElementById('tomorrow-date');
            
            // Format the date for display (e.g., "Tuesday, July 27")
            const date = new Date(entry.date + 'T00:00:00'); // Assume midnight in local timezone
            const formattedDate = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

            priceValueElement.textContent = entry.price.toFixed(1); // Format to one decimal place
            tomorrowDateElement.textContent = formattedDate;
        }

        // --- Function to Create the Chart ---
        function createChart(data) {
            const ctx = document.getElementById('gasPriceChart').getContext('2d');
            
            // We only want to show the last 30 entries for clarity
            const chartData = data.slice(-30);

            const labels = chartData.map(item => item.date);
            const prices = chartData.map(item => item.price);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gas Price (¢/L)',
                        data: prices,
                        borderColor: '#3b82f6', // Blue line
                        backgroundColor: 'rgba(59, 130, 246, 0.1)', // Light blue fill
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3, // Makes the line smooth
                        pointBackgroundColor: '#1e3a8a', // Dark blue points
                        pointRadius: 4,
                        pointHoverRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false, // Don't start the axis at 0
                            ticks: {
                                // Add '¢' to the Y-axis labels
                                callback: function(value, index, values) {
                                    return value + '¢';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 0,
                                minRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 7 // Show a reasonable number of dates
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // Hide the legend as it's self-explanatory
                        },
                        tooltip: {
                            callbacks: {
                                // Customize the tooltip to show price with '¢'
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(1) + '¢';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Run the App ---
        // This starts the process when the page has finished loading.
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
